<!doctype html>
<!--[if lt IE 7]>
<html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>
<html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>
<html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js"> <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <title>Two Truck</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="style/animate.css" />
    <link rel="stylesheet" href="style/bootstrap.min.css">
	<link rel="stylesheet" href="style/main.css">
	<link rel="stylesheet" href="style/style.css">
 
	<script type="text/javascript" src="https://www.google.com/jsapi"></script>
	<script type="text/javascript" src="https://www.google.com/uds/?file=visualization&amp;v=1&amp;hl=fr&amp;packages=corechart&amp;async=2"></script>
	<link type="text/css" href="https://www.google.com/uds/api/visualization/1.0/ff67c3772da186a412ae3231c32409e9/ui+fr.css" rel="stylesheet">
	<script type="text/javascript" src="https://www.google.com/uds/api/visualization/1.0/ff67c3772da186a412ae3231c32409e9/format+fr,default+fr,ui+fr,corechart+fr.I.js"></script>
	<link href="https://ajax.googleapis.com/ajax/static/modules/gviz/1.0/core/tooltip.css" rel="stylesheet" type="text/css">
				
<style>
.Loading {
    display: inline-block;
    vertical-align: middle;
    background-position: center;
    background:no-repeat;
    background-image: url('data:image/gif;base64,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');
    width:20px;
    height:20px;
    margin-top:6px;
    margin-right:7px;
}
.AutocompleteDropDown {
	background-color: #fcf8e3;
	}
</style>	
		
</head>
<body ng-app="towtruck">


<!--  Page Directory: @_PAGEDIRECTORY_@ -->





<div class="bs-component"  ng-controller="TowTruckControler as towtruckctrl">
	
	<center>
	<table><tr>
			<td><h1>Tow Truck</h1></td>
			<td rowspan="2"><img src="img/towtruck.jpg?" width="150" heigth="150" /></td>
		</tr>
		<tr><td style="font-size:0.8em"> <a href="" ng-click="towtruckctrl.showhistory( ! towtruckctrl.isshowhistory )">V1.2</a></td></tr>
		<tr><td>
			<div id="showHistory" ng-show="towtruckctrl.isshowhistory" style="border-width:2px;border-style:ridge;border-color:blue">
				1.0 First version<br>
				1.1 New request to detect the missing timer<br>
				1.2 Execute Groovy script
			</div>
		</td></tr>
	</table>
	</center>

	
	<div class="col-lg-12">
	
		<legend class="text-primary"><span class="glyphicon glyphicon-th"></span>Groovy</legend>
		<h3>Groovy Execution</h3>
		<div class="well">The groovy code is executed on the server. This operation has to be done under the control of Bonitasoft Support</div>
				
		<input type="radio" ng-model="towtruckctrl.groovy.type" value="src" >Source
		<input type="radio" ng-model="towtruckctrl.groovy.type" value="code" >Code
	 
		<!--  First : load from a Code -->
		<div ng-show="towtruckctrl.groovy.type == 'code' || towtruckctrl.groovy.type==''">
			<table>
				<tr><td>Bonitasoft Code : <input ng-model="towtruckctrl.groovy.code"></td>
					<td> <button  ng-click="towtruckctrl.groovyload()" class="btn btn-info btn-xs" ng-disabled="towtruckctrl.inprogress">Load</button></td>
				<tr><td colspan="3"><div ng-bind-html="towtruckctrl.getListEvents(towtruckctrl.groovy.listeventsload )"></div></td></tr>
						
				<!--  </tr><td colspan="3"><div class="alert alert-success" ng-show="towtruckctrl.groovy.loadstatus.length>0">{{towtruckctrl.groovy.loadstatus}}</div> -->
					
				<tr>
				<tr ng-repeat="groovyparam in towtruckctrl.groovy.parameters">
					<td>{{groovyparam.label}}</td>
					<td><input ng-model="groovyparam.value"></td>
					<td><div class="well" ng-show="groovyparam.tips.length > 0">{{groovyparam.tips}}</div></td>
				</tr>
			</table>				
		</div>
				
		<!--  source code -->
		<div ng-show="towtruckctrl.groovy.type == 'src' || towtruckctrl.groovy.type==''">
			<table>
				<tr><td>Groovy Source Code</td></tr>
					<tr><td><textarea ng-model="towtruckctrl.groovy.src" cols="80" rows="20"></textarea></td></tr>		
				<tr><td><div class="font-style: italic;">In your Groovy code, you can use 'apiAccessor', 'apiClient' and 'restAPIContext' variables. Example : ProcessAPI = apiAccessor.getProcessAPI();</div>
			</table>
		</div>
				
		<table>
			<tr><td>
				<div ng-show="towtruckctrl.inprogress"><span class="Loading">.</span></div>
				</td><td>
				<button  ng-click="towtruckctrl.groovyexecute()" class="btn btn-warning btn-xs" ng-disabled="towtruckctrl.inprogress">Execute</button>
				</td>
			</tr>
		</table>
		<div ng-bind-html="towtruckctrl.getListEvents(towtruckctrl.groovy.listevents )"></div>
			<p>
				
		<div class="alert alert-success" ng-show="towtruckctrl.groovy.result.length>0">{{towtruckctrl.groovy.result}}</div>
		<div class="alert alert-danger" ng-show="towtruckctrl.groovy.exception.length>0">{{towtruckctrl.groovy.exception}}</div>
									

				
		<legend class="text-primary"><span class="glyphicon glyphicon-th"></span>Timers</legend>
		<h3>Missing Timers</h3>
		<table><tr><td>
				<div ng-show="towtruckctrl.inprogress"><span class="Loading">.</span></div>
				</td><td>
				<button  ng-click="towtruckctrl.getmissingtimer()" class="btn btn-info btn-xs" ng-disabled="towtruckctrl.inprogress">Collect informations</button>
				</td>
				</tr>
		</table>
		{{towtruckctrl.timerstatus}}
		</table>
			<!-- for the final page, remove this button 
			<button id="collectbtn" ng-click="towtruckctrl.deletetimers()" class="btn btn-info btn-xs">Delete timers</button> 
			-->
		<div class="alert alert-danger" role="alert" ng-show="towtruckctrl.timererror.length > 0">{{towtruckctrl.timererror}}</div>
			
		<table class="table table-striped table-hover table-condensed" style="background-color:#C49E71">
			<tr>
				<th>Name</th>
				<th>Statename</th>
				<th>CaseId</th>
				<th>Process Definition ID</th>
				<th>Process Name</th>
				<th>Process Version</th>
			</tr>
			<tr ng-repeat="timer in towtruckctrl.listtimers track by $index">
				<td>{{timer.name}}</td>
				<td>{{timer.statename}}</td>
				<td>{{timer.processinstanceid}}</td>
				<td>{{timer.processdefinitionid}}</td>
				<td>{{timer.processdefinitionname}}</td>
				<td>{{timer.processdefinitionversion}}</td>
			</tr>
		</table>
			
		<table border="2" ng-show="towtruckctrl.listtimers.length > 0 ">
			<tr>
				<td  style="border:10px">
					<b>Statename = waiting</b> <br>
					<b>Effect:</b> the quartz timer for a timer in waiting state will be recreated
					<b>Implementation:</b> On each timer, the method timerEventHandlerStrategy.handleCatchEvent() is called<br>
					Limitation:</b> this operation works only on "waiting" timer.<br>
				
			<!-- the create does not work </td><td  >
				The time is create again in the quartz table, by a schedulerService.schedule()<br>
				<button  ng-click="towtruckctrl.createmissingtimers('recreate')" class="btn btn-info btn-xs" >Create</button>
				-->
				</td><td>
					<b>Statename = waiting</b> <br>
					<b>Effect:</b> will skip the current waiting timer and go to the next step.<br>
					<b>Implementation:</b> execute the task by the method processAPI.executeFlowNode()<br>					
					<b>Limitation:</b> this operation works only on "waiting" timer.<br>
				</td><td>
				    <b>Statename = failed</b> <br>
					<b>Effect:</b> the timer will be retried.
					<b>Implementation:</b> apply on the task the method processAPI.retryTask().<br>
					<b>Limitation:</b> this operation works only on "failed" timer.<br>
				</td>
			</tr><tr>
				<td>
					<div style="text-align:center;">
						<button  ng-click="towtruckctrl.createmissingtimers('handle')" class="btn btn-info btn-xs" >Handle timer</button>
					</div>
				</td><td>					
					<div style="text-align:center;">
						<button  ng-click="towtruckctrl.createmissingtimers('executeTask')" class="btn btn-info btn-xs" >Execute</button>
					</div>
				</td><td>					
					<div style="text-align:center;">
							<button  ng-click="towtruckctrl.createmissingtimers('retrytask')" class="btn btn-info btn-xs" >Retry</button>
						</div>
					</td>
			</tr>				
		</table>
				
		<br>
		{{towtruckctrl.missingtimerstatus}}
				
	</div>

</div>
		


<!-- Third party dependencies -->


<script src="3rd-party/jquery.min.js"></script>

<script src="3rd-party/angular.min.js"></script>

<script src="3rd-party/angular-resource.min.js"></script>
<script src="3rd-party/angular-cookies.min.js"></script>

<script src="3rd-party/bootstrap/js/bootstrap.min.js"></script>
<script src="3rd-party/angular-bootstrap-tpls.min.js"></script>
<script src="3rd-party/angular-sanitize.min.js"></script> 

<script src="twotruckmonitor.js?v=@_CURRENTTIMEMILIS_@"></script>

<!-- Application dependencies -->

</body>
</html>		